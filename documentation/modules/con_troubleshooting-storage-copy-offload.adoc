// Module included in the following assemblies:
//
// * documentation/doc-Migrating_your_virtual_machines/assemblies/assembly_troubleshooting-migration.adoc

:_mod-docs-content-type: CONCEPT
[id="con_troubleshooting-storage-copy-offload_{context}"]
= Troubleshooting storage copy offload

This section describes problems that are unique to storage copy offload and how you can resolve them.

[id=sco-vsphere-esxi-connectivity_{context}]
== vSphere-ESXi connectivity issues

Remote ESXi connection fails with a SOAP error::
+
*Description*: Sometimes a remote ESXi execution fails, returning a SOAP error with no apparent root cause message.
+
*Explanation*: Because vSphere invokes some SOAP/REST endpoints on the ESXi, a connection can fail because of standard error reasons that vanish after the next try.
+
*Solution*: If the populator fails, the migration can be restarted. Try to restart or retry the populator, or restart the migration.

VIB issues returned with a CLI error::
+
*Description*: {project-first} returns the following error:
+
[source,terminal]
----
CLI Fault: The object or item referred to could not be found. <obj xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:vim25" versionId="5.0" xsi:type="LocalizedMethodFault"><fault xsi:type="NotFound"></fault><localizedMessage>The object or item referred to could not be found.</localizedMessage></obj>
----
+
*Explanation*: If the VIB is installed, but `/etc/init.d/hostd` did not restart, then the `vmkfstools` namespace in `esxcli` is either not updated or does not exist. If that namespace does not exist, it means that this is the first usage, probably right after the first use.
+
*Solution*: Use SSH to log in to the ESXi and run `/etc/init.d/hostd restart`. Wait for a few seconds until the ESXi renews the connection with vSphere.

[id=sco-ssh-issues_{context}]
== SSH error messages

Manual SSH key connection errors::
+
*Description*: {project-short} returns one of the following errors: `Manual SSH key configuration required`, `Failed to connect via SSH`, or `SSH connection timeout`.
+
*Explanation*: The SSH connection is not running on the ESXi host for one of the following reasons:

** The SSH is disabled.
+
*Solution*: Manually enable an SSH connection on the ESXi host by using the commands in {mtv-mig}assembly_planning-migration-vmware_mtv#proc_storage-copy-offload-manual-ssh-set-up_vmware[Setting up storage copy offload using manually generated SSH keys].

** There is a problem with the network connectivity.
+
*Solution*: Verify that the ESXi management network is accessible from the migration pods.

** Timeout issue (least likely issue)
+
*Solution*: Increase the value of `SSH_TIMEOUT_SECONDS` in the provider `Secret`.
+
Verification steps for the preceding solutions:
+
** To verify that the SSH service is running on an ESXi host, run the following command:
+
[source,terminal]
----
$ vim-cmd hostsvc/get_ssh_status 
----
+
** To manually test SSH connectivity from a migration pod, run the following command:
+
[source,terminal]
----
$ ssh -i /path/to/<private_key> root@<ESXI_host_Ip>
----

[id=sco-netapp-issues_{context}]
== NetApp Error

*Description*: {project-short} returns the following error:

`Cannot derive SVM to use; please specify SVM in config file`

*Explanation*: ONTAP is not configured correctly.

*Solution*: Configure your default ONTAP Storage Virtual Machine (SVM) by running the following commands:

. Show the current configuration for the SVM by running the following command on the ONTAP server:
+
[source,terminal]
----
$ vserver show -vserver ${NAME_OF_SVM}
----

. Set a management interface for the SVM and enter its `hostname` in the `STORAGE_HOSTNAME` by following the instructions in the NetApp Knowledge Base article, link: https://kb.netapp.com/Cloud/Astra/Trident/Trident_fails_to_access_ONTAP_on_SVM_level_and_on_Cluster_level[Trident fails to access ONTAP on SVM level and on Cluster level]. The link requires you to log in.